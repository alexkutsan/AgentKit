name: Secret Scan

on:
  pull_request:
  workflow_dispatch:
    inputs:
      scan_depth:
        description: "Scan mode: 'pr' scans PR diff range (base..head). 'full' scans full repository history."
        required: false
        default: "pr"
        type: choice
        options:
          - pr
          - full

jobs:
  trufflehog:
    name: TruffleHog
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: TruffleHog (PR range)
        if: github.event_name == 'pull_request' || (github.event_name == 'workflow_dispatch' && inputs.scan_depth == 'pr')
        uses: trufflesecurity/trufflehog@main
        with:
          extra_args: --results=verified,unknown

      - name: TruffleHog (full history)
        if: github.event_name == 'workflow_dispatch' && inputs.scan_depth == 'full'
        uses: trufflesecurity/trufflehog@main
        with:
          extra_args: --results=verified,unknown --no-verification
